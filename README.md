# terraform-ansible-ec2-lab

---


## ğŸ“ Repository Structure

```
terraform-ansible-ec2-lab/
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf            # EC2 resources & inventory generation
â”‚   â”œâ”€â”€ provider.tf        # AWS provider configuration
â”‚   â”œâ”€â”€ variables.tf       # Input variables
â”‚   â”œâ”€â”€ outputs.tf         # EC2 public IP outputs
â”‚   â”œâ”€â”€ inventory.tpl      # Ansible inventory template
â”‚   â””â”€â”€ inventory.ini      # Auto-generated by Terraform
â”‚
â”œâ”€â”€ ansible/
â”‚   â”œâ”€â”€ playbook.yml       # Frontend & Backend configuration
â”‚   â””â”€â”€ ansible.cfg        # Ansible settings
â”‚
â”œâ”€â”€ .gitignore             # Ignored files
â””â”€â”€ README.md              # Project documentation
```

---

## ğŸ› ï¸ How to Fix Common Issues

### **1. Terraform Not Initializing**

If you see:

```
Terraform initialized in an empty directory!
```

â¡ï¸ Make sure your `.tf` files exist inside the **terraform/** folder.
Run:

```sh
cd terraform
terraform init
```

---

### **2. Terraform Inventory Not Generated**

If `inventory.ini` is missing:

1. Verify the output block in `outputs.tf`
2. Re-run:

```sh
terraform apply
```

3. Confirm this line exists in `main.tf`:

```hcl
templatefile("${path.module}/inventory.tpl", {...})
```

---

### **3. Ansible Unable to Connect to EC2**

If SSH fails:

âœ” Ensure the instance has a **public IP**
âœ” Ensure security group allows:

```
Inbound: port 22 (SSH)
```

âœ” Use the correct private key:

```sh
ansible-playbook -i inventory.ini playbook.yml --private-key ~/.ssh/yourkey.pem
```

---

### **4. Ansible â€œPython Not Foundâ€ Error**

Install Python on EC2:

```sh
sudo yum install python3 -y
```

---

### **5. AWS Provider Authentication Issue**

If you see:

```
Unable to locate credentials
```

Fix by configuring AWS CLI:

```sh
aws configure
```

---

### **6. State Lock Issues (S3 Backend)**

If using remote state and it gets stuck:

Unlock manually:

```sh
terraform force-unlock <LOCK_ID>
```

---

If you want, I can generate a **full clean README.md** combining everything (overview, usage, diagrams, setup steps, troubleshooting).


# Terraform + Ansible EC2 Automation

## Description
This project demonstrates:
- EC2 provisioning using Terraform
- Dynamic Ansible inventory generation
- Configuration management using Ansible frontend/backend groups

## Architecture
- Amazon Linux (Frontend â†’ Apache)
- Ubuntu 21.04 (Backend â†’ Nginx)

## Steps to Run

### Terraform
```bash
cd terraform
terraform init
terraform apply
